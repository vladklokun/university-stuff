# Encoding: UTF-8 (without BOM). If you are seeing weird symbols, make sure to use a proper text editor like Notepad++, Atom, Sublime Text, Vim or Emacs (Windows Notepad does NOT work) and set encoding to UTF-8 (without BOM).

# Как пользоваться

Понадобится рабочий Python 3.

1. Создаём файл с матрицей переходов. Для этого копируем файл 01-prob-matrix.txt, задаём нужное имя файла (например, 01-prob-matrix-var09.txt), и устанавливаем значения вашей матрицы переходов. Матрица должна быть квадратной. По заданию лабы №2 её размерность — 16×16, учитывая операторные и файловые вершины. 

Формат колонок матрицы такой:
------------------------------------------------------
       | V_{a1} V_{b1} V_{a2} V_{b2} ... V_{an} V_{bn}
------------------------------------------------------
V_{a1} | 
V_{b1} | 
V_{a2} | 
V_{b2} | 
...    | 
V_{an} | 
V_{bn} | 
------------------------------------------------------

Вершина в строке — это вершина-источник (откуда), в столбце — вершина-назначение (куда).

Внимание! Скопировав файл примера, нужно всего лишь изменить числовые значения на свои (например, с 0.000 → 0.050 в нужной ячейке), и больше ничего не дописывать. 

Строки, начинающиеся с символа «#» — это комментарии, они игнорируются.

2. Создаём файл с коэффициентами числа операций k. Для этого копируем файл 02-coeffs-k.txt, задаём нужное имя файла (например, 02-coeffs-k-var09.txt), и устанавливаем значения ваших коэффициентов. Эти значения даются в задании на лабораторную работу.

3. Создаём файл с коэффициентами количества информации, которая передаётся при выполнении оператора обращения — l. Для этого копируем файл 03-coeffs-l.txt, задаём нужное имя файла (например, 02-coeffs-l-var09.txt), и устанавливаем значения ваших коэффициентов. Эти значения даются в задании на лабораторную работу.

4. Создаём файл, который описывает, к какому из файлов принадлежат файловые вершины V_{bi}. Для этого копируем файл 04-filemap.txt, задаём нужное имя файла (например, 04-filemap-var09.txt), и устанавливаем, какие вершины принадлежат какому из файлов. Эти значения даются в задании на лабораторную работу на схеме алгоритма. Номер файла, к которому обращается файловая вершина — это верхний индекс её названия. Например, вершина V^{3}_{b2} обращается к файлу №3.

Формат файла 04-filemap.txt такой: номер рядка соответствует номеру файла, к которому принадлежат вершины, номера которых записаны в строке. Строки, начинающиеся с символа «#» — это комментарии, они игнорируются.

Например:
# File 1
1 2 4
# File 2
3 5 8
# File 3
6 7

Это значит:
# Комментарий
Файл 1: вершина V_{b1}, V_{b2}, V_{b4}
# Комментарий
Файл 2: вершина V_{b3}, V_{b5}, V_{b8}
# Комментарий
Файл 3: вершина V_{b6}, V_{b7}

5. Теперь подготовка файлов завершена. Для этого открываем командную строку в папке, где находится программа для решения (pysolver): в окне Проводника, где открыта эта программа, нажимаем Левой Клавишей Мыши в свободное пространство окна, потом — Shift + Правая Клавиша Мыши → «Открыть окно команд». Появится Командная строка Windows.

6. Переключаемся в среду с нужными программами. Для этого в командной строке вводим такую команду:

venv\Scripts\activate.bat

И нажимаем Enter. Перед путём к папке должен появиться префикс (venv).

7. Запускаем программу. Для этого запоминаем названия файлов, которые мы создали в начале в пунктах 1–4 и вводим команду по такому принципу:

python pysolver.py <путь к файлу матрицы вероятностей перехода> <путь к файлу коэффициентов k> <путь к файлу коэффициентов l> <путь к файлу соответствий файловых вершин номерам файлов из задания>

На примере этого README команда будет выглядеть так:

python pysolver.py 01-prob-matrix-var09.txt 02-coeffs-k-var09.txt 03-coeffs-l.txt 04-filemap-var09.txt

И нажимаем Enter.

В результате получим вывод вида:  

Equation system saved to file 05-res-eq-sys-2019-03-23T124201.txt.
n_vals_op = [4.58190149 0.02290951 0.45819015 1.03092784 3.09278351 3.09278351 0.43528064 1.03092784],
n_vals_io = [4.58190149 0.02290951 0.45819015 3.09278351 1.03092784 3.09278351 0.43528064 1.03092784]
theta_primary = 451.5463917525775
N_h = {0: 7.697594501718216, 1: 2.520045819014892, 2: 3.5280641466208498}
theta_h = {0: 552.0833333333334, 1: 190.90909090909093, 2: 137.01298701298703}
theta_0 = 32.85

Разберём его:

1. Equation system saved to file 05-res-eq-sys-2019-03-23T124201.txt.
Показывает, что таблица, соответствующая системе уравнений, сохранена в файл «05-res-eq-sys-2019-03-23T124201.txt».

Система уравнений очень широкая, поэтому откройте окно текстового редактора пошире. Она имеет формат вида:

      n_{a1}  ...    n_{b5}    n_{a6}    n_{b6}  ...    = x
--  --------  ---  --------  --------  --------  ---  -----
 0        -1  ...      0            0      0     ...     -1
 1         1  ...      0            0      0     ...      0
 2         0  ...      0            0      0     ...      0
 3         0  ...      0            0      0     ...      0
 4         0  ...      0            0      0     ...      0
 5         0  ...      0            0      0     ...      0
 6         0  ...      0            0      0     ...      0
 7         0  ...      0            1      0     ...      0
 8         0  ...      0            0      0     ...      0
 9         0  ...     -1            0      0     ...      0
10         0  ...      0.75        -1      0.75  ...      0


В таблице первая колонка — это индекс уравнения (то есть порядковый номер минус 1), а остальные колонки — значения коэффициентов для заданной переменной.

Например, рассмотрим строку 10. В этой строке все многоточия после первой колонки обозначают ячейки с нулевыми значениями:
--  --------  ---  --------  --------  --------  ---  -----
      n_{a1}  ...    n_{b5}    n_{a6}    n_{b6}  ...    = x
--  --------  ---  --------  --------  --------  ---  -----
10         0  ...      0.75        -1      0.75  ...      0
--  --------  ---  --------  --------  --------  ---  -----

Составляем уравнение:
0n_{a1} + ... + 0.75n_{b5} + -1n_{a6} + 0.75n_{b6} + ... = 0.

И так для всех строчек в таблице.

2. n_vals_op = [4.58190149 0.02290951 0.45819015 1.03092784 3.09278351 3.09278351 0.43528064 1.03092784]

n_vals_op — это значения среднего количества обращений к операторным вершинам V_{ai}. Порядковый номер числа — это и есть номер вершины. Например число 3.09278351 — пятое в списке, то есть имеет порядковый номер 5, поэтому соответствует вершине V_{a5}.

3. n_vals_io = [4.58190149 0.02290951 0.45819015 3.09278351 1.03092784 3.09278351 0.43528064 1.03092784]

n_vals_io — это значения среднего количества обращений к операторным вершинам V_{bi}. Порядковый номер числа — это и есть номер вершины. Например число 1.03092784 — пятое в списке, то есть имеет порядковый номер 5, поэтому соответствует вершине V_{b5}.

4. theta_primary = 451.5463917525775

theta_primary — это значение \theta_{основное} или просто \theta в задании на лабораторную работу — среднее количество операций за один прогон заданого алгоритма. 

5. N_h = {0: 7.697594501718216, 1: 2.520045819014892, 2: 3.5280641466208498}

N_h — это среднее количество обращений к каждому из файлов.

6. theta_h = {0: 552.0833333333334, 1: 190.90909090909093, 2: 137.01298701298703}

theta_h — это среднее количество информации, которая передаётся при одном обращении к файлу. Формат: {<номер файла - 1>: <значение>}. Например, запись {0: 552.0833333333334, ...} значит, что среднее количество информации, которая передаётся при одном обращении к файлу 1 (0+1 из-за индексирования) — 552.0833333333334 единиц (байт). 

7. theta_0 = 32.85
theta_0 — значение средней трудоёмкости этапа вычислений.

Чтобы выводить все детали вычислений, включая систему уравнений, надо запустить программу с параметром -p. Например, так:

python pysolver.py -p 01-prob-matrix-var09.txt 02-coeffs-k-var09.txt 03-coeffs-l.txt 04-filemap-var09.txt