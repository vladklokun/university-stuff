# ON L2 SWITCHES
# # Create VLANs
en
conf t
### this can be skipped, since switchport creates missing VLANs automatically
### vlan 2
### name USERS
int range fa0/1-24
switchport mode access
switchport access vlan 2
end
# VLANs created
int gi0/1
switchport mode trunk
switchport trunk allowed vlan 2-4
exit
exit
wr mem

int range fa0/1-24
switchport mode access
switchport acccess vlan 2

# ON L3 SWITCH
# Create VLANs on L3 Switch
en
conf t
int range fa0/1-3
switchport trunk encapsulation dot1q
switchport mode trunk
switchport trunk allowed vlan 2-4
end
# assign IP addresses to created VLANs
int vlan 2
ip address 192.168.56.193 255.255.255.224
int vlan 3
ip address 192.168.56.225 255.255.255.240
int vlan 4
ip address 192.168.56.242 255.255.255.240
exit
ip routing
vlan 2
vlan 3
vlan 4

## Config DHCP inside the L3 Switch
int vlan 2
ip dhcp pool DHCP-VLAN2
network 192.168.56.192 255.255.255.224
default-router 192.168.56.193
dns-server 1.1.1.1
exit
## Exclude router IP address
ip dhcp excluded-address 192.168.56.193

int vlan 3
ip dhcp pool DHCP-VLAN3
network 192.168.56.224 255.255.255.240
default-router 192.168.56.225
dns-server 1.1.1.1
exit
## Exclude router IP address
ip dhcp excluded-address 192.168.56.225

int vlan 4
ip dhcp pool DHCP-VLAN3
network 192.168.56.240 255.255.255.240
default-router 192.168.56.242
dns-server 1.1.1.1
exit
## Exclude router IP address
ip dhcp excluded-address 192.168.56.241
ip dhcp excluded-address 192.168.56.242

## Create VLAN for intranet resources so the router can access them
int gi0/1
switchport mode access
switchport access vlan 4
exit

int vlan 4
ip address 192.168.56.242

# Router config
## Dont do the initial configuration
no
## Assign an IP address to the inside interface
int gi0/1
ip address 192.168.56.241 255.255.255.240
no shutdown
## Add IP routes so the router can access the intranet
ip route 192.168.56.192 255.255.255.224 192.168.56.242
ip route 192.168.56.224 255.255.255.240 192.168.56.242
ip route 192.168.56.240 255.255.255.240 192.168.56.242
wr mem

## ISP Router connectivity
conf t
int gi0/0
ip address 178.12.46.115 255.254.0.0
no shutdown
exit
ip route 0.0.0.0 0.0.0.0 178.12.46.1


## NAT configuration

### Define outside and inside interface
int gi0/0
ip nat outside
int gi0/1
ip nat inside

## Create access list
ip access-list standard FOR-NAT
permit 192.168.56.192 0.0.0.31
permit 192.168.56.224 0.0.0.15
permit 192.168.56.240 0.0.0.15

### Define nat application rule
ip nat inside source list FOR-NAT int gi0/0 overload

# ISP Router Configuration
no
en
conf t
int gi0/1
ip address 178.12.46.1 255.254.0.0
int gi0/2
ip address 178.12.47.1 255.254.0.0
